# 其他

单元测试相关技巧及工具收集。

&nbsp;

## 示例

示例代码最大用途不是测试，而是导入到 `GoDoc` 等工具生成的帮助文档。</br>

比对输出(`stdout`)结果和内部`output`注释是否一致来判断是否成功。</br>

* 不能使用内置函数 `print/println`，因为它们输出到 `stderr`。
* 没有输出注释的示例被编译，但不执行。

```go
package main

import (
        "fmt"
)

func ExampleAdd() {
        fmt.Println(add(1, 2))
        fmt.Println(add(2, 2))

        // Output:
        // 3
        // 4
}
```

&nbsp;

```bash
root@8d75790f92f5:~/go/david# go test -v -run "Example"
=== RUN   ExampleAdd
--- PASS: ExampleAdd (0.00s)
PASS
ok      david   0.002s
```

&nbsp;

失败，输出如下信息:

```bash
root@8d75790f92f5:~/go/david# go test -v -run "Example"
=== RUN   ExampleAdd
--- FAIL: ExampleAdd (0.00s)
got:
3
4
want:
4
4
FAIL
exit status 1
FAIL    david   0.002s
```

&nbsp;

支持无序匹配。

```go
package main

import (
        "fmt"
)

func ExampleAdd() {
        fmt.Println(add(1, 2))
        fmt.Println(add(2, 2))

        // Output:
        // 4
        // 3
}
```

&nbsp;

## 入口

像 `main.main` 那样，为测试提供一个入口函数。

* 同样放在 `_test.go` 文件内。
* 为整个测试过程提供 `setup/teardown` 机制。
* 在 `main goroutine` 中执行。

```go
func TestMain(m *testing.M) {
    // setup
    code := m.Run()     // 调用测试函数。
    // teardown

    os.Exit(code)       // 注意: os.Exit 不会执行 defer.
}
```
